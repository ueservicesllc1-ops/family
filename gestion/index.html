<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de gesti√≥n de env√≠os Family Express - USA a Ecuador">
    <title>Family Express - Sistema de Gesti√≥n de Env√≠os</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../styles/styles.css">

    <!-- Favicon -->
    <link rel="icon" href="../images/favicon.png">
</head>

<body>

    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">üì¶</div>
            <h1>Family Express</h1>
            <p>Sistema de Gesti√≥n de Env√≠os USA ‚Üí Ecuador</p>
            <button id="google-login-btn" class="btn btn-primary btn-lg">
                <span>üîê</span>
                Iniciar sesi√≥n con Google
            </button>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container">
        <div class="app-layout">

            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="logo">
                    <div class="logo-icon">üì¶</div>
                    <div class="logo-text">
                        <h2>Family Express</h2>
                        <p>Gesti√≥n de Env√≠os</p>
                    </div>
                </div>

                <nav class="nav-menu">
                    <div class="nav-item active" data-page="dashboard">
                        <span class="nav-item-icon">üìä</span>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-page="clients">
                        <span class="nav-item-icon">üë•</span>
                        <span>Clientes</span>
                    </div>
                    <div class="nav-item" data-page="shipments">
                        <span class="nav-item-icon">üì¶</span>
                        <span>Env√≠os</span>
                    </div>
                    <div class="nav-item" data-page="tracking">
                        <span class="nav-item-icon">üîç</span>
                        <span>Rastreo</span>
                    </div>
                    <div class="nav-item" data-page="lockers">
                        <span class="nav-item-icon">üóÑÔ∏è</span>
                        <span>Casilleros Virtuales</span>
                    </div>
                    <div class="nav-item" data-page="reports">
                        <span class="nav-item-icon">üìà</span>
                        <span>Reportes</span>
                    </div>
                </nav>

                <div class="user-profile">
                    <img id="user-photo" src="" alt="User" class="user-avatar"
                        onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë§</text></svg>'">
                    <div class="user-info">
                        <h4 id="user-name">Usuario</h4>
                        <p id="user-email">email@example.com</p>
                    </div>
                </div>

                <button id="logout-btn" class="btn btn-secondary" style="width: 100%;">
                    <span>üö™</span>
                    Cerrar Sesi√≥n
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Dashboard</h1>
                            <p>Vista general del sistema de env√≠os</p>
                        </div>
                    </div>

                    <div class="stats-grid" id="stats-grid">
                        <!-- Stats will be populated by JavaScript -->
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Env√≠os Recientes</h3>
                        </div>
                        <div id="recent-shipments">
                            <!-- Recent shipments will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Clients Page -->
                <div id="clients-page" class="page hidden">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Clientes</h1>
                            <p>Gesti√≥n de clientes y registro consular</p>
                        </div>
                        <button id="add-client-btn" class="btn btn-primary">
                            <span>‚ûï</span>
                            Nuevo Cliente
                        </button>
                    </div>

                    <div class="card">
                        <div class="form-group">
                            <input type="text" id="client-search" class="form-input"
                                placeholder="Buscar clientes por nombre, tel√©fono, email o ID...">
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Tel√©fono</th>
                                        <th>Email</th>
                                        <th>Categor√≠a</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clients-table-body">
                                    <!-- Clients will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Shipments Page -->
                <div id="shipments-page" class="page hidden">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Env√≠os</h1>
                            <p>Gesti√≥n de paquetes y env√≠os</p>
                        </div>
                        <button id="add-shipment-btn" class="btn btn-primary">
                            <span>‚ûï</span>
                            Nuevo Env√≠o
                        </button>
                    </div>

                    <div class="card">
                        <div class="flex gap-2 mb-3">
                            <select id="shipment-status-filter" class="form-select" style="max-width: 200px;">
                                <option value="">Todos los estados</option>
                                <option value="pending">Pendiente</option>
                                <option value="in_transit">En tr√°nsito</option>
                                <option value="delivered">Entregado</option>
                                <option value="cancelled">Cancelado</option>
                            </select>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Cliente</th>
                                        <th>Categor√≠a</th>
                                        <th>Valor</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="shipments-table-body">
                                    <!-- Shipments will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tracking Page -->
                <div id="tracking-page" class="page hidden">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Rastreo de Paquetes</h1>
                            <p>Consulta el estado de tu env√≠o</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">C√≥digo de Rastreo</label>
                            <div class="flex gap-2">
                                <input type="text" id="tracking-search" class="form-input"
                                    placeholder="Ej: FE-20241224-0001">
                                <button id="tracking-search-btn" class="btn btn-primary">Buscar</button>
                            </div>
                        </div>

                        <div id="tracking-results" class="hidden">
                            <!-- Tracking results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-page" class="page hidden">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Reportes</h1>
                            <p>Informes y estad√≠sticas del negocio</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">Per√≠odo</label>
                            <div class="flex gap-2">
                                <input type="date" id="report-start-date" class="form-input">
                                <input type="date" id="report-end-date" class="form-input">
                                <button id="generate-report-btn" class="btn btn-primary">Generar Reporte</button>
                            </div>
                        </div>

                        <div id="report-results">
                            <!-- Report results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Virtual Lockers Page -->
                <div id="lockers-page" class="page hidden">
                    <div class="page-header">
                        <div class="page-title">
                            <h1>Casilleros Virtuales</h1>
                            <p>Gesti√≥n de alertas y paquetes de usuarios registrados</p>
                        </div>
                    </div>

                    <div id="lockers-grid" class="grid-container"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                        <!-- Cards populated via JS -->
                        <div style="text-align: center; color: #64748b; padding: 2rem;">Cargando casilleros...</div>
                    </div>
                </div>

                <!-- Locker Detail Page/View (Overlay or Separate Section) -->
                <!-- Let's make it a hidden page for better flow -->
                <div id="locker-detail-page" class="page hidden">
                    <button class="btn btn-secondary mb-3" onclick="navigateToPage('lockers')">‚Üê Volver a
                        Casilleros</button>

                    <div class="page-header">
                        <div class="flex items-center gap-3">
                            <div id="locker-user-avatar"
                                style="width:50px; height:50px; background:#e2e8f0; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                üë§</div>
                            <div>
                                <h1 id="locker-user-name">Usuario</h1>
                                <p id="locker-suite-id" style="font-weight: bold; color: var(--primary);">Suite: FE-XXXX
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4">
                        <h3 class="card-title mb-3">Paquetes Alertados (Pre-Alertas)</h3>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Tracking</th>
                                        <th>Tienda / Contenido</th>
                                        <th>Factura</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="locker-alerts-body">
                                    <!-- Populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="client-modal-title">Nuevo Cliente</h3>
                <button class="modal-close" onclick="closeModal('client-modal')">‚úï</button>
            </div>

            <form id="client-form">
                <div class="form-group">
                    <label class="form-label required">Nombre Completo</label>
                    <input type="text" id="client-fullname" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label required">Tel√©fono</label>
                    <input type="tel" id="client-phone" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="client-email" class="form-input">
                </div>

                <div class="form-group">
                    <label class="form-label required">Direcci√≥n en Ecuador</label>
                    <textarea id="client-address" class="form-textarea" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label required">N√∫mero de Identificaci√≥n</label>
                    <input type="text" id="client-idnumber" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label required">Categor√≠a</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="client-category" value="B" checked>
                            Categor√≠a B (Sin registro consular)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="client-category" value="G">
                            Categor√≠a G (Con registro consular)
                        </label>
                    </div>
                </div>

                <div id="consular-section" class="hidden">
                    <div class="form-group">
                        <label class="form-label required">N√∫mero de Registro Consular</label>
                        <input type="text" id="client-registration" class="form-input">
                        <p id="new-client-family-hint" class="hidden"
                            style="color:#0ea5e9; font-size:0.9rem; margin-top:5px; background:#e0f2fe; padding:8px; border-radius:6px;">
                            ‚ÑπÔ∏è Primero <strong>Guarde el Cliente</strong>. El sistema le permitir√° agregar a los
                            familiares inmediatamente despu√©s.
                        </p>
                    </div>
                </div>

                <div id="client-family-list" class="hidden">
                    <!-- Populated via JS -->
                </div>

                <div class="form-group">
                    <label class="form-label">Foto/Documento (Opcional)</label>
                    <input type="file" id="client-photo" class="form-input" accept="image/*">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('client-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="spinner hidden" id="client-submit-spinner"></span>
                        <span id="client-submit-text">Guardar Cliente</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Family Member Modal -->
    <div id="family-member-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üë®‚Äçüë©‚Äçüëß Agregar Familiar en Ecuador</h3>
                <button class="modal-close" onclick="closeModal('family-member-modal')">‚úï</button>
            </div>

            <form id="family-member-form">
                <div class="form-group">
                    <label class="form-label required">Nombre Completo</label>
                    <input type="text" id="fm-name" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label required">Parentesco</label>
                    <select id="fm-relationship" class="form-select" required>
                        <option value="">Seleccione...</option>
                        <option value="hijo/a">Hijo/a</option>
                        <option value="padre/madre">Padre/Madre</option>
                        <option value="esposo/a">Esposo/a</option>
                        <option value="hermano/a">Hermano/a</option>
                        <option value="tio/a">T√≠o/a</option>
                        <option value="primo/a">Primo/a</option>
                        <option value="sobrino/a">Sobrino/a</option>
                        <option value="cunado/a">Cu√±ado/a</option>
                        <option value="nieto/a">Nieto/a</option>
                        <option value="abuelo/a">Abuelo/a</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label required">C√©dula Ecuatoriana</label>
                    <input type="text" id="fm-cedula" class="form-input" required>
                </div>

                <div class="form-group" style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label class="form-label">Foto C√©dula (Frente)</label>
                        <input type="file" id="fm-photo-front" class="form-input" accept="image/*">
                    </div>
                    <div style="flex:1;">
                        <label class="form-label">Foto C√©dula (Reverso)</label>
                        <input type="file" id="fm-photo-back" class="form-input" accept="image/*">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Tel√©fono</label>
                    <input type="tel" id="fm-phone" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label required">Direcci√≥n Completa</label>
                    <textarea id="fm-address" class="form-textarea" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label required">Ciudad</label>
                    <input type="text" id="fm-city" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label required">Provincia</label>
                    <input type="text" id="fm-province" class="form-input" required>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('family-member-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="spinner hidden" id="fm-submit-spinner"></span>
                        <span id="fm-submit-text">Guardar Familiar</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shipment Modal -->
    <div id="shipment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nuevo Env√≠o</h3>
                <button class="modal-close" onclick="closeModal('shipment-modal')">‚úï</button>
            </div>

            <form id="shipment-form">
                <div class="form-group">
                    <label class="form-label required">Cliente</label>
                    <select id="shipment-client" class="form-select" required>
                        <option value="">Seleccione un cliente...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label required">Contenido del Paquete</label>
                    <div class="checkbox-group" id="package-items">
                        <!-- Items will be populated by JavaScript -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Valor Declarado (USD)</label>
                    <input type="number" id="shipment-value" class="form-input" step="0.01" min="0" max="400" required>
                    <small style="color: var(--text-muted);">M√°ximo: $400 USD</small>
                </div>

                <div id="cost-breakdown-container" class="hidden mt-3">
                    <!-- Cost breakdown will be populated by JavaScript -->
                </div>

                <div id="recipient-section" class="hidden mt-3"
                    style="border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                    <h4 class="mb-2 font-bold">Destinatario en Ecuador</h4>

                    <div id="recipient-select-container">
                        <div class="form-group">
                            <label class="form-label">Seleccionar Familiar Registrado</label>
                            <select id="recipient-select" class="form-select">
                                <!-- Populated via JS -->
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use-manual-recipient" onchange="toggleRecipientInput()">
                            <span>Ingresar destinatario manualmente</span>
                        </label>
                    </div>

                    <div id="recipient-manual-container" class="hidden"
                        style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e2e8f0;">
                        <div class="form-group">
                            <label class="form-label required">Nombre Completo</label>
                            <input type="text" id="recipient-name" class="form-input">
                        </div>
                        <div class="grid grid-cols-2 gap-2"
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <div class="form-group">
                                <label class="form-label required">C√©dula</label>
                                <input type="text" id="recipient-id" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Tel√©fono</label>
                                <input type="text" id="recipient-phone" class="form-input">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Provincia</label>
                            <input type="text" id="recipient-province" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Ciudad</label>
                            <input type="text" id="recipient-city" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Direcci√≥n</label>
                            <input type="text" id="recipient-address" class="form-input">
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label class="form-label required">M√©todo de Pago</label>
                    <select id="payment-method" class="form-select">
                        <option value="cash">Efectivo</option>
                        <option value="transfer">Transferencia</option>
                        <option value="card">Tarjeta de Cr√©dito</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('shipment-modal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="spinner hidden" id="shipment-submit-spinner"></span>
                        <span id="shipment-submit-text">Crear Env√≠o</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Shipment Detail Modal -->
    <div id="shipment-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detalles del Env√≠o</h3>
                <button class="modal-close" onclick="closeModal('shipment-detail-modal')">‚úï</button>
            </div>

            <div id="shipment-detail-content">
                <!-- Shipment details will be populated by JavaScript -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    onclick="closeModal('shipment-detail-modal')">Cerrar</button>
            </div>
        </div>
        <!-- Process Alert Modal (Receive Package) -->
        <div id="process-alert-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Recibir Paquete</h3>
                    <button class="modal-close" onclick="closeModal('process-alert-modal')">‚úï</button>
                </div>

                <form id="process-alert-form">
                    <input type="hidden" id="process-alert-id">
                    <input type="hidden" id="process-user-id">
                    <input type="hidden" id="process-user-name">

                    <div class="form-group">
                        <label class="form-label">Tracking Code</label>
                        <input type="text" id="process-tracking" class="form-input" readonly
                            style="background: #f1f5f9;">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Peso (Libras)</label>
                        <input type="number" id="process-weight" class="form-input" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Dimensiones (opcional)</label>
                        <input type="text" id="process-dimensions" class="form-input" placeholder="Ej: 10x10x10">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Foto del Paquete Recibido</label>
                        <input type="file" id="process-photo" class="form-input" accept="image/*" required>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                            onclick="closeModal('process-alert-modal')">Cancelar</button>
                        <button type="submit" class="btn btn-success">
                            <span class="spinner hidden" id="process-submit-spinner"></span>
                            <span id="process-submit-text">Confirmar Recepci√≥n</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- App JavaScript -->
        <script type="module" src="../src/app.js"></script>
</body>

</html>